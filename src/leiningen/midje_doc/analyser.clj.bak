(ns leiningen.midje-doc.analyser
  (:require [clj-pdf.core :as pdf]
            [rewrite-clj.parser :as p]
            [rewrite-clj.printer :as pr]
            [rewrite-clj.zip :as z]))


(pdf/pdf
 [{:title "Ribol - Conditional Restarts for Clojure"
   :title "Ribol - Conditional Restarts for Clojure"}])

(pdf/pdf
  [{:title         "Test doc"
    :header        "page header"
    :subject       "Some subject"
    :creator       "Jane Doe"
    :doc-header    ["inspired by" "William Shakespeare"]
    :right-margin  50
    :author        "John Doe"
    :bottom-margin 50
    :left-margin   50
    :top-margin    50
    :chapter      {:size 18 :top-margin 20}
    :size          "a4"
    :footer        "page"
    :font   {:family :helvetica}}

   [:chapter  [:paragraph "Introduction"]]

   [:anchor {:target "http://google.com"} "google"]

   [:anchor {:style {:size 15} :leading 20 :id "targetAnchor"} "some anchor"]

   [:anchor {:target "#targetAnchor"} "this anchor points to some anchor"]

   [:anchor [:phrase {:style :bold} "some anchor phrase"]]

[:anchor "plain anchor"]
   [:chunk {:style :bold} "small chunk of text"]
   [:chapter [:paragraph "Chapter"]
    [:section "Section Title" "Some content"]
    [:section [:paragraph {:size 10} "Section Title"]
     [:paragraph "Some content"]
     [:paragraph "Some more content"]
     [:section {:color [100 200 50]} [:paragraph "Nested Section Title"]
              [:paragraph "nested section content"]]]]

   [:heading "Lorem Ipsum"]

   [:paragraph
    "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec non iaculis lectus. Integer vel libero libero. Phasellus metus augue, consequat a viverra vel, fermentum convallis sem. Etiam venenatis laoreet quam, et adipiscing mi lobortis sit amet. Fusce eu velit vitae dolor vulputate imperdiet. Suspendisse dui risus, mollis ut tempor sed, dapibus a leo. Aenean nisi augue, placerat a cursus eu, convallis viverra urna. Nunc iaculis pharetra pretium. Suspendisse sit amet erat nisl, quis lacinia dolor. Integer mollis placerat metus in adipiscing. Fusce tincidunt sapien in quam vehicula tincidunt. Integer id ligula ante, interdum sodales enim. Suspendisse quis erat ut augue porta laoreet."]

   [:paragraph
    "Sed pellentesque lacus vel sapien facilisis vehicula. Quisque non lectus lacus, at varius nibh. Integer porttitor porttitor gravida. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Phasellus accumsan ante tincidunt magna dictum vulputate. Maecenas suscipit commodo leo sed mattis. Morbi dictum molestie justo eu egestas. Praesent lacus est, euismod vitae consequat non, accumsan in justo. Nam rhoncus dapibus nunc vel dignissim."]

   [:paragraph
    "Nulla id neque ac felis tempor pretium adipiscing ac tortor. Aenean ac metus sapien, at laoreet quam. Vivamus id dui eget neque mattis accumsan. Aliquam aliquam lacinia lorem ut dapibus. Fusce aliquam augue non libero viverra ut porta nisl mollis. Mauris in justo in nibh fermentum dapibus at ut erat. Maecenas vitae fermentum lectus. Nunc dolor nisl, commodo a pellentesque non, tincidunt id dolor. Nulla tellus neque, consectetur in scelerisque vitae, cursus vel urna. Phasellus ullamcorper ultrices nisi ac feugiat."]]

  "example.pdf")

(def doc (z/of-file "/Users/Chris/dev/chit/ribol/test/ribol/test_ribol_strategies.clj"))

(def doc2 (z/of-string (with-out-str (prn '{:a {:b {:c 1}} :d 1 :e 1}))))

(-> doc2)

(z/prewalk doc2 identity)
h
[:map [:token :a] [:whitespace " "] [:map [:token :b] [:whitespace " "] [:map [:token :c] [:whitespace " "] [:token 1]]] [:whitespace ", "]
 [:token :d] [:whitespace " "] [:token 1] [:whitespace ", "] [:token :e] [:whitespace " "] [:token 1]]

(-> doc
    (z/find-value z/next 'fact)
    (z/find-value z/next 1)
    z/up
    z/node)



(ip/transform
 {:forms identity}
 (-> (z/of-string "^{:hello \"boo\"}
 ;;; comment


[1 2 3 4]") z/root)

 )

[:forms [:meta [:map [:token :hello] [:whitespace " "] [:token "boo"]] [:whitespace " "] [:vector [:token 1] [:whitespace " "] [:token 2] [:whitespace " "] [:token 3] [:whitespace " "] [:token 4]]]]






(->
 (z/of-string "^{:hello \"boo\"} [1 2 3 4] 1 2 3") z/root)
